<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Dashboard - Pharmacy Admin</title>
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .financial-container {
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .page-header h1 {
            margin: 0 0 10px;
            font-size: 32px;
        }

        .page-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 16px;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 25px rgba(0,0,0,0.15);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
        }

        .kpi-card.revenue::before { background: #4caf50; }
        .kpi-card.expenses::before { background: #f44336; }
        .kpi-card.profit::before { background: #2196f3; }
        .kpi-card.margin::before { background: #ff9800; }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .kpi-title {
            font-size: 14px;
            color: #7f8c8d;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-icon {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .kpi-icon.green { background: #e8f5e9; color: #4caf50; }
        .kpi-icon.red { background: #ffebee; color: #f44336; }
        .kpi-icon.blue { background: #e3f2fd; color: #2196f3; }
        .kpi-icon.orange { background: #fff3e0; color: #ff9800; }

        .kpi-value {
            font-size: 36px;
            font-weight: 700;
            color: #2c3e50;
            margin: 10px 0;
        }

        .kpi-change {
            font-size: 13px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            border-radius: 20px;
        }

        .kpi-change.positive {
            background: #e8f5e9;
            color: #4caf50;
        }

        .kpi-change.negative {
            background: #ffebee;
            color: #f44336;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .chart-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .period-selector {
            display: flex;
            gap: 5px;
        }

        .period-btn {
            padding: 6px 12px;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s ease;
        }

        .period-btn:hover {
            background: #f8f9fa;
        }

        .period-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .chart-canvas {
            max-height: 300px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }

        .summary-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .summary-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 18px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            color: #7f8c8d;
            font-size: 14px;
        }

        .summary-value {
            font-weight: 700;
            font-size: 16px;
            color: #2c3e50;
        }

        .summary-value.positive {
            color: #4caf50;
        }

        .summary-value.negative {
            color: #f44336;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            color: #764ba2;
            gap: 12px;
        }

        .expense-breakdown {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }

        .breakdown-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .breakdown-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 18px;
        }

        .breakdown-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .breakdown-item:last-child {
            border-bottom: none;
        }

        .breakdown-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .breakdown-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .breakdown-info {
            flex: 1;
        }

        .breakdown-category {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .breakdown-bar {
            height: 6px;
            background: #f0f0f0;
            border-radius: 3px;
            overflow: hidden;
        }

        .breakdown-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }

        .breakdown-amount {
            font-weight: 700;
            font-size: 16px;
            color: #2c3e50;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="financial-container">
        <!-- Back Link -->
        <a href="../admin/index.html" class="back-link">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>

        <!-- Page Header -->
        <div class="page-header">
            <h1><i class="fas fa-chart-line"></i> Financial Dashboard</h1>
            <p>Comprehensive overview of pharmacy financial performance and analytics</p>
        </div>

        <!-- Key Performance Indicators -->
        <div class="kpi-grid">
            <div class="kpi-card revenue">
                <div class="kpi-header">
                    <span class="kpi-title">Total Revenue</span>
                    <div class="kpi-icon green">
                        <i class="fas fa-arrow-trend-up"></i>
                    </div>
                </div>
                <div class="kpi-value" id="kpiRevenue">KSh 0.00</div>
                <span class="kpi-change positive" id="kpiRevenueChange">
                    <i class="fas fa-arrow-up"></i> 0% vs last month
                </span>
            </div>

            <div class="kpi-card expenses">
                <div class="kpi-header">
                    <span class="kpi-title">Total Expenses</span>
                    <div class="kpi-icon red">
                        <i class="fas fa-arrow-trend-down"></i>
                    </div>
                </div>
                <div class="kpi-value" id="kpiExpenses">KSh 0.00</div>
                <span class="kpi-change positive" id="kpiExpensesChange">
                    <i class="fas fa-arrow-down"></i> 0% vs last month
                </span>
            </div>

            <div class="kpi-card profit">
                <div class="kpi-header">
                    <span class="kpi-title">Net Profit</span>
                    <div class="kpi-icon blue">
                        <i class="fas fa-sack-dollar"></i>
                    </div>
                </div>
                <div class="kpi-value" id="kpiProfit">KSh 0.00</div>
                <span class="kpi-change positive" id="kpiProfitChange">
                    <i class="fas fa-arrow-up"></i> 0% vs last month
                </span>
            </div>

            <div class="kpi-card margin">
                <div class="kpi-header">
                    <span class="kpi-title">Profit Margin</span>
                    <div class="kpi-icon orange">
                        <i class="fas fa-percent"></i>
                    </div>
                </div>
                <div class="kpi-value" id="kpiMargin">0%</div>
                <span class="kpi-change positive" id="kpiMarginChange">
                    <i class="fas fa-arrow-up"></i> 0% vs last month
                </span>
            </div>
        </div>

        <!-- Charts -->
        <div class="charts-grid">
            <!-- Revenue vs Expenses Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3><i class="fas fa-chart-bar"></i> Revenue vs Expenses</h3>
                    <div class="period-selector">
                        <button class="period-btn" onclick="changePeriod('7days')">7 Days</button>
                        <button class="period-btn active" onclick="changePeriod('30days')">30 Days</button>
                        <button class="period-btn" onclick="changePeriod('12months')">12 Months</button>
                    </div>
                </div>
                <canvas id="revenueExpensesChart" class="chart-canvas"></canvas>
            </div>

            <!-- Profit Trend Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3><i class="fas fa-chart-line"></i> Profit Trend</h3>
                    <div class="period-selector">
                        <button class="period-btn" onclick="changePeriod('7days')">7 Days</button>
                        <button class="period-btn active" onclick="changePeriod('30days')">30 Days</button>
                        <button class="period-btn" onclick="changePeriod('12months')">12 Months</button>
                    </div>
                </div>
                <canvas id="profitTrendChart" class="chart-canvas"></canvas>
            </div>
        </div>

        <!-- Expense Category Breakdown -->
        <div class="expense-breakdown">
            <div class="breakdown-header">
                <i class="fas fa-chart-pie" style="color: #667eea;"></i>
                <h3>Expense Breakdown by Category (This Month)</h3>
            </div>
            <div id="expenseBreakdownContainer">
                <p style="text-align: center; color: #7f8c8d; padding: 20px;">Loading expense breakdown...</p>
            </div>
        </div>

        <br>

        <!-- Summary Cards -->
        <div class="summary-grid">
            <!-- Monthly Summary -->
            <div class="summary-card">
                <div class="summary-header">
                    <i class="fas fa-calendar-alt" style="color: #667eea;"></i>
                    <h3>This Month Summary</h3>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Sales Revenue</span>
                    <span class="summary-value positive" id="monthSales">KSh 0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Operating Expenses</span>
                    <span class="summary-value negative" id="monthExpenses">KSh 0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Supplier Payments</span>
                    <span class="summary-value negative" id="monthSupplierPayments">KSh 0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Net Profit/Loss</span>
                    <span class="summary-value" id="monthProfit">KSh 0.00</span>
                </div>
            </div>

            <!-- Year to Date Summary -->
            <div class="summary-card">
                <div class="summary-header">
                    <i class="fas fa-chart-simple" style="color: #4caf50;"></i>
                    <h3>Year to Date Summary</h3>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Total Sales</span>
                    <span class="summary-value positive" id="ytdSales">KSh 0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Total Expenses</span>
                    <span class="summary-value negative" id="ytdExpenses">KSh 0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Total Payments</span>
                    <span class="summary-value negative" id="ytdPayments">KSh 0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Net Profit/Loss</span>
                    <span class="summary-value" id="ytdProfit">KSh 0.00</span>
                </div>
            </div>

            <!-- Cash Flow Summary -->
            <div class="summary-card">
                <div class="summary-header">
                    <i class="fas fa-money-bill-trend-up" style="color: #2196f3;"></i>
                    <h3>Cash Flow (This Month)</h3>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Cash In (Sales)</span>
                    <span class="summary-value positive" id="cashIn">KSh 0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Cash Out (Expenses)</span>
                    <span class="summary-value negative" id="cashOutExpenses">KSh 0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Cash Out (Suppliers)</span>
                    <span class="summary-value negative" id="cashOutSuppliers">KSh 0.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Net Cash Flow</span>
                    <span class="summary-value" id="netCashFlow">KSh 0.00</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global chart instances
        let revenueExpensesChart = null;
        let profitTrendChart = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadFinancialData();
            initializeCharts();
        });

        // Load financial data
        async function loadFinancialData() {
            try {
                // Load stats from expenses API
                const expensesResponse = await fetch('../../backend/api/expenses.php?action=stats', {
                    credentials: 'include'
                });
                const expensesData = await expensesResponse.json();

                // Load stats from supplier payments API
                const paymentsResponse = await fetch('../../backend/api/supplier_payments.php?action=stats', {
                    credentials: 'include'
                });
                const paymentsData = await paymentsResponse.json();

                // Update KPIs with real or sample data
                updateKPIs(expensesData, paymentsData);
                updateSummaries(expensesData, paymentsData);
                updateExpenseBreakdown();

            } catch (error) {
                console.error('Error loading financial data:', error);
                // Use sample data if API fails
                useSampleData();
            }
        }

        // Update KPIs
        function updateKPIs(expensesData, paymentsData) {
            // Sample data for demonstration
            const revenue = 850000;
            const expenses = (expensesData.success ? parseFloat(expensesData.stats.month_total || 0) : 0) + 
                           (paymentsData.success ? parseFloat(paymentsData.stats.month_total || 0) : 0);
            const profit = revenue - expenses;
            const margin = revenue > 0 ? ((profit / revenue) * 100).toFixed(1) : 0;

            document.getElementById('kpiRevenue').textContent = 'KSh ' + revenue.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('kpiExpenses').textContent = 'KSh ' + expenses.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('kpiProfit').textContent = 'KSh ' + profit.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('kpiMargin').textContent = margin + '%';

            // Update change indicators
            updateChangeIndicator('kpiRevenueChange', 12.5, true);
            updateChangeIndicator('kpiExpensesChange', -8.3, true);
            updateChangeIndicator('kpiProfitChange', 18.2, true);
            updateChangeIndicator('kpiMarginChange', 2.4, true);
        }

        // Update change indicators
        function updateChangeIndicator(elementId, change, isPositive) {
            const element = document.getElementById(elementId);
            const absChange = Math.abs(change);
            const icon = change >= 0 ? 'arrow-up' : 'arrow-down';
            
            element.className = `kpi-change ${isPositive ? 'positive' : 'negative'}`;
            element.innerHTML = `<i class="fas fa-${icon}"></i> ${absChange}% vs last month`;
        }

        // Update summaries
        function updateSummaries(expensesData, paymentsData) {
            const monthSales = 850000;
            const monthExpenses = expensesData.success ? parseFloat(expensesData.stats.month_total || 0) : 125000;
            const monthPayments = paymentsData.success ? parseFloat(paymentsData.stats.month_total || 0) : 450000;
            const monthProfit = monthSales - monthExpenses - monthPayments;

            document.getElementById('monthSales').textContent = 'KSh ' + monthSales.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('monthExpenses').textContent = 'KSh ' + monthExpenses.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('monthSupplierPayments').textContent = 'KSh ' + monthPayments.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('monthProfit').textContent = 'KSh ' + monthProfit.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('monthProfit').className = monthProfit >= 0 ? 'summary-value positive' : 'summary-value negative';

            // Year to Date
            const ytdSales = 9500000;
            const ytdExpenses = 1800000;
            const ytdPayments = 5200000;
            const ytdProfit = ytdSales - ytdExpenses - ytdPayments;

            document.getElementById('ytdSales').textContent = 'KSh ' + ytdSales.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('ytdExpenses').textContent = 'KSh ' + ytdExpenses.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('ytdPayments').textContent = 'KSh ' + ytdPayments.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('ytdProfit').textContent = 'KSh ' + ytdProfit.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('ytdProfit').className = ytdProfit >= 0 ? 'summary-value positive' : 'summary-value negative';

            // Cash Flow
            document.getElementById('cashIn').textContent = 'KSh ' + monthSales.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('cashOutExpenses').textContent = 'KSh ' + monthExpenses.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('cashOutSuppliers').textContent = 'KSh ' + monthPayments.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('netCashFlow').textContent = 'KSh ' + monthProfit.toLocaleString('en-KE', {minimumFractionDigits: 2});
            document.getElementById('netCashFlow').className = monthProfit >= 0 ? 'summary-value positive' : 'summary-value negative';
        }

        // Update expense breakdown
        function updateExpenseBreakdown() {
            const categories = [
                { name: 'Salaries', amount: 85000, icon: 'users', color: '#4caf50' },
                { name: 'Rent', amount: 65000, icon: 'building', color: '#2196f3' },
                { name: 'Utilities', amount: 32000, icon: 'bolt', color: '#ff9800' },
                { name: 'Maintenance', amount: 18000, icon: 'wrench', color: '#9c27b0' },
                { name: 'Marketing', amount: 12000, icon: 'bullhorn', color: '#f44336' },
                { name: 'Transport', amount: 8000, icon: 'truck', color: '#00bcd4' }
            ];

            const total = categories.reduce((sum, cat) => sum + cat.amount, 0);
            
            const html = categories.map(cat => {
                const percentage = ((cat.amount / total) * 100).toFixed(1);
                return `
                    <div class="breakdown-item">
                        <div class="breakdown-left">
                            <div class="breakdown-icon" style="background: ${cat.color}20; color: ${cat.color};">
                                <i class="fas fa-${cat.icon}"></i>
                            </div>
                            <div class="breakdown-info">
                                <div class="breakdown-category">${cat.name}</div>
                                <div class="breakdown-bar">
                                    <div class="breakdown-bar-fill" style="width: ${percentage}%; background: ${cat.color};"></div>
                                </div>
                            </div>
                        </div>
                        <div class="breakdown-amount">KSh ${cat.amount.toLocaleString('en-KE')}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('expenseBreakdownContainer').innerHTML = html;
        }

        // Initialize charts
        function initializeCharts() {
            // Revenue vs Expenses Chart
            const revenueCtx = document.getElementById('revenueExpensesChart').getContext('2d');
            revenueExpensesChart = new Chart(revenueCtx, {
                type: 'bar',
                data: {
                    labels: getLast30DaysLabels(),
                    datasets: [{
                        label: 'Revenue',
                        data: generateSampleRevenue(30),
                        backgroundColor: 'rgba(76, 175, 80, 0.8)',
                        borderColor: 'rgba(76, 175, 80, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Expenses',
                        data: generateSampleExpenses(30),
                        backgroundColor: 'rgba(244, 67, 54, 0.8)',
                        borderColor: 'rgba(244, 67, 54, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'KSh ' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Profit Trend Chart
            const profitCtx = document.getElementById('profitTrendChart').getContext('2d');
            profitTrendChart = new Chart(profitCtx, {
                type: 'line',
                data: {
                    labels: getLast30DaysLabels(),
                    datasets: [{
                        label: 'Profit',
                        data: generateSampleProfit(30),
                        borderColor: 'rgba(33, 150, 243, 1)',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return 'KSh ' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Helper functions for chart data
        function getLast30DaysLabels() {
            const labels = [];
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-GB', { day: '2-digit', month: 'short' }));
            }
            return labels;
        }

        function generateSampleRevenue(days) {
            const data = [];
            for (let i = 0; i < days; i++) {
                data.push(Math.floor(Math.random() * 50000) + 20000);
            }
            return data;
        }

        function generateSampleExpenses(days) {
            const data = [];
            for (let i = 0; i < days; i++) {
                data.push(Math.floor(Math.random() * 25000) + 5000);
            }
            return data;
        }

        function generateSampleProfit(days) {
            const revenue = generateSampleRevenue(days);
            const expenses = generateSampleExpenses(days);
            return revenue.map((rev, idx) => rev - expenses[idx]);
        }

        // Change period function
        function changePeriod(period) {
            // Update active button
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update charts based on period
            console.log('Period changed to:', period);
            // TODO: Implement period change logic
        }

        // Use sample data fallback
        function useSampleData() {
            updateKPIs({ success: false }, { success: false });
            updateSummaries({ success: false }, { success: false });
            updateExpenseBreakdown();
        }
    </script>
</body>
</html>
